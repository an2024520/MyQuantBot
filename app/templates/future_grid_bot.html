<!DOCTYPE html>
<html>
<head>
    <title>ÂêàÁ∫¶ÁΩëÊ†ºÁªàÁ´Ø v7.9 Pause</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #000; color: #d4d4d4; padding: 20px; font-family: monospace; font-size: 13px; }
        .card { background: #111; border: 1px solid #333; margin-bottom: 15px; }
        .card-header { border-bottom: 1px solid #333; color: #f0b90b; font-weight: bold; }
        .form-control, .form-select { background: #222; border: 1px solid #444; color: #fff; font-size: 12px; }
        .form-control:focus { background: #222; color: #fff; border-color: #f0b90b; box-shadow: none; }
        
        .btn-launch { background: #f0b90b; border: none; color: #000; font-weight: bold; }
        .btn-launch:hover { background: #dba809; }
        
        .btn-update { background: #0dcaf0; border: none; color: #000; font-weight: bold; }
        .btn-update:hover { background: #0bb5d8; }
        
        .btn-stop { background: #da3633; border: none; }
        .btn-stop:hover { background: #b02a28; }
        
        .btn-verify { 
            background: #198754; border: 1px solid #198754; color: #fff; font-size: 12px; 
            margin-bottom: 10px; width: 100%; padding: 5px; transition: all 0.2s;
        }
        .btn-verify:hover { background: #157347; border-color: #146c43; }
        
        .grid-wall { height: 500px; overflow-y: auto; background: #050505; }
        .grid-row { display: flex; justify-content: space-between; padding: 4px 10px; border-bottom: 1px solid #222; }
        .risk-val { font-size: 1.1rem; font-weight: bold; color: #fff; }
        .risk-label { color: #666; font-size: 0.8rem; }
        .pos-long { color: #0ecb81; }
        .pos-short { color: #f6465d; }
        .balance-val { color: #f0b90b; font-size: 1.3rem; font-weight: bold; }
        
        .hot-update-field { border-color: #0dcaf0 !important; }
        .hot-update-label { color: #0dcaf0; font-size: 10px; margin-left: 5px; }
    </style>
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-3">
            <div class="card border-warning">
                <div class="card-header">üî• Hard Core ÂèÇÊï∞</div>
                <div class="card-body">
                    <form id="configForm">
                        <div class="mb-2">
                            <label>Á≠ñÁï•Ê®°Âºè</label>
                            <select class="form-select text-warning" name="strategy_type">
                                <option value="neutral">‰∏≠ÊÄßÈúáËç° (Neutral)</option>
                                <option value="long">ÂÅöÂ§öÁΩëÊ†º (Long)</option>
                                <option value="short">ÂÅöÁ©∫ÁΩëÊ†º (Short)</option>
                            </select>
                        </div>
                        
                        <div class="mb-2">
                            <label>‰∫§ÊòìÊâÄ</label>
                            <select class="form-select" name="exchange_id">
                                <option value="binance">Binance</option>
                                <option value="okx">OKX (Ê¨ßÊòì)</option>
                            </select>
                        </div>

                        <div class="mb-2">
                            <label>Ê®°ÊãüËµÑÈáë (USDT)</label>
                            <input class="form-control" name="sim_balance" type="number" value="1000" placeholder="‰ªÖÊ®°ÊãüÊ®°ÂºèÊúâÊïà">
                        </div>

                        <div class="row g-1 mb-2">
                            <div class="col-8">
                                <label>Â∏ÅÁßç</label>
                                <select class="form-select" name="coin">
                                    <option value="BTC">BTC</option>
                                    <option value="ETH">ETH</option>
                                    <option value="SOL">SOL</option>
                                </select>
                            </div>
                            <div class="col-4">
                                <label>ËÆ°‰ª∑</label>
                                <select class="form-select" name="quote">
                                    <option value="USDT">USDT</option>
                                    <option value="USDC">USDC</option>
                                </select>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="d-flex justify-content-between">
                                <span>Êù†ÊùÜÂÄçÊï∞</span>
                                <span class="text-warning" id="lev-val">1x</span>
                            </label>
                            <input type="range" class="form-range" name="leverage" min="1" max="100" value="1" oninput="document.getElementById('lev-val').innerText=this.value+'x'">
                        </div>

                        <div class="mb-2">
                            <button type="button" class="btn btn-verify" onclick="checkBalance()">
                                üîç ÁÇπÂáªÊü•ËØ¢‰∫§ÊòìÊâÄ‰ΩôÈ¢ù
                            </button>
                        </div>

                        <div class="mb-2"><input class="form-control" name="api_key" placeholder="API Key (ÂøÖÂ°´)"></div>
                        <div class="mb-2"><input class="form-control" name="secret" type="password" placeholder="Secret Key (ÂøÖÂ°´)"></div>
                        <div class="mb-2"><input class="form-control" name="password" type="password" placeholder="Passphrase (OKXÂøÖÂ°´)"></div>
                        
                        <hr style="border-color:#444">
                        <div class="text-muted small mb-1">‚¨áÔ∏è ËìùËâ≤ËæπÊ°ÜÈ°πÂèØÂú®ËøêË°åÊó∂‰øÆÊîπ</div>

                        <div class="row g-1 mb-2">
                            <div class="col">
                                <label>Ê≠¢Êçü‰ª∑ <span class="hot-update-label">Hot</span></label>
                                <input class="form-control hot-update-field" name="stop_loss" type="number" placeholder="Ê≠¢Êçü‰ª∑">
                            </div>
                            <div class="col">
                                <label>Ê≠¢Áõà‰ª∑ <span class="hot-update-label">Hot</span></label>
                                <input class="form-control hot-update-field" name="take_profit" type="number" placeholder="Ê≠¢Áõà‰ª∑">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label>ÊåÇÂçïÁ™óÂè£ (Active Window) <span class="hot-update-label">Hot</span></label>
                            <input class="form-control hot-update-field" name="active_order_limit" type="number" min="1" max="20" value="5" placeholder="ÂçïËæπÊåÇÂçïÊï∞">
                        </div>

                        <hr style="border-color:#444">

                        <div class="row g-1 mb-2">
                            <div class="col"><input class="form-control" name="lower_price" type="number" placeholder="‰∏ãÈôê" value="80000"></div>
                            <div class="col"><input class="form-control" name="upper_price" type="number" placeholder="‰∏äÈôê" value="100000"></div>
                        </div>
                        <div class="row g-1 mb-2">
                            <div class="col">
                                <label>Ê†ºÊï∞</label>
                                <input class="form-control" name="grid_num" type="number" placeholder="Ê†ºÊï∞" value="20">
                            </div>
                            <div class="col">
                                <label>Êï∞Èáè (OKXÂ°´Âº†, BNÂ°´Â∏Å)</label>
                                <input class="form-control" name="amount" type="number" step="0.00001" placeholder="Êï∞Èáè" value="0.0001">
                            </div>
                        </div>
                        
                        <div class="row g-2 mt-3">
                            <div class="col-3">
                                <button type="button" class="btn btn-launch w-100" onclick="start()">üöÄ ÂêØÂä®</button>
                            </div>
                            <div class="col-3">
                                <button type="button" class="btn btn-update w-100" onclick="updateParams()">üîÑ Êõ¥Êñ∞</button>
                            </div>
                            <div class="col-3">
                                <button type="button" class="btn btn-warning w-100" id="btn-pause" onclick="togglePause()" disabled>‚è∏ ÊöÇÂÅú</button>
                            </div>
                            <div class="col-3">
                                <button type="button" class="btn btn-stop w-100" onclick="stop()">‚èπ ÂÅúÊ≠¢</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header text-danger">Ë¥¶Êà∑ÁõëÊéß</div>
                <div class="card-body">
                    <div class="text-center mb-3 border-bottom pb-2">
                        <div class="balance-val" id="wallet-balance">---</div>
                        <div class="risk-label">Ë¥¶Êà∑ÊÄªÊùÉÁõä</div>
                    </div>

                    <div class="row text-center mb-2">
                        <div class="col">
                            <div class="risk-val" id="pos-amt">0</div>
                            <div class="risk-label">ÊåÅ‰ªìÊï∞Èáè</div>
                        </div>
                        <div class="col">
                            <div class="risk-val text-warning" id="entry-price">0</div>
                            <div class="risk-label">ÊåÅ‰ªìÂùá‰ª∑</div>
                        </div>
                    </div>
                    <div class="row text-center">
                         <div class="col">
                            <div class="risk-val text-danger" id="liq-price">---</div>
                            <div class="risk-label">Âº∫Âπ≥‰ª∑</div>
                        </div>
                        <div class="col">
                            <div class="risk-val text-muted" id="funding-rate">0.0000%</div>
                            <div class="risk-label">Ë¥πÁéá</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span>
                        ÊåÇÂçïÂ¢ô 
                        <span class="ms-2 small text-muted">ÂΩìÂâç‰ª∑: <span id="cur-price" class="text-white">---</span></span>
                    </span>
                    <div>
                         <span class="badge bg-dark border border-secondary me-1">SMI: <span id="smi-val">--</span></span>
                         <span class="badge bg-secondary" id="status-badge">OFFLINE</span>
                    </div>
                </div>
                <div class="grid-wall" id="grid-wall"></div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="card h-100">
                <div class="card-header">Êó•Âøó</div>
                <div class="log-box" id="logs" style="height:600px;overflow-y:auto;color:#888;"></div>
            </div>
        </div>
    </div>
</div>

<script>
    function start() {
        const formData = new FormData(document.getElementById('configForm'));
        const data = Object.fromEntries(formData);
        data.symbol = `${data.coin}/${data.quote}`;
        fetch('/api/future/start', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(data)})
        .then(r=>r.json()).then(res => { if(res.status!=='ok') alert(res.msg); });
    }
    
    function stop() { fetch('/api/future/stop', {method:'POST'}); }

    function updateParams() {
        const formData = new FormData(document.getElementById('configForm'));
        const data = Object.fromEntries(formData);
        fetch('/api/future/update', {
            method: 'POST', 
            headers: {'Content-Type': 'application/json'}, 
            body: JSON.stringify(data)
        })
        .then(r => r.json())
        .then(res => {
            alert(res.msg);
        })
        .catch(err => alert("Êõ¥Êñ∞Â§±Ë¥•: " + err));
    }

    function togglePause() {
        const btn = document.getElementById('btn-pause');
        const isPaused = btn.innerText.includes('ÊÅ¢Â§ç');
        const url = isPaused ? '/api/future/resume' : '/api/future/pause';
        
        fetch(url, {method:'POST'})
        .then(r=>r.json())
        .then(res => {
            if(res.status!=='ok') alert(res.msg);
        });
    }

    function checkBalance() {
        const formData = new FormData(document.getElementById('configForm'));
        const data = Object.fromEntries(formData);
        
        if (!data.api_key || !data.secret) {
            alert("ËØ∑ÂÖàÂ°´ÂÜô API Key Âíå Secret KeyÔºÅ");
            return;
        }
        if (data.exchange_id === 'okx' && !data.password) {
            alert("OKX ‰∫§ÊòìÊâÄÂøÖÈ°ªÂ°´ÂÜô PassphraseÔºÅ");
            return;
        }

        const balElem = document.getElementById('wallet-balance');
        const oldText = balElem.innerText;
        balElem.innerText = "Checking...";

        fetch('/api/check_balance', {
            method: 'POST', 
            headers: {'Content-Type': 'application/json'}, 
            body: JSON.stringify(data)
        })
        .then(r => r.json())
        .then(res => {
            if (res.status === 'ok') {
                balElem.innerText = res.balance.toFixed(2) + ' ' + data.quote;
            } else {
                alert("Êü•ËØ¢Â§±Ë¥•: " + res.msg);
                balElem.innerText = oldText;
            }
        })
        .catch(err => {
            alert("ËØ∑Ê±ÇÈîôËØØ: " + err);
            balElem.innerText = oldText;
        });
    }

    setInterval(() => {
        fetch('/api/future/status').then(r=>r.json()).then(d => {
            const amt = d.current_pos || 0;
            const amtElem = document.getElementById('pos-amt');
            amtElem.innerText = amt.toFixed(4);
            amtElem.className = amt > 0 ? 'risk-val pos-long' : (amt < 0 ? 'risk-val pos-short' : 'risk-val');
            
            document.getElementById('entry-price').innerText = d.entry_price ? d.entry_price.toFixed(2) : '---';
            
            const liq = d.liquidation || d.liquidation_price || 0;
            document.getElementById('liq-price').innerText = liq > 0 ? liq.toFixed(2) : '---';
            
            document.getElementById('funding-rate').innerText = 
                d.funding_rate !== undefined ? d.funding_rate.toFixed(4) + '%' : '0.0000%';
            
            if (d.running && d.wallet_balance > 0) {
                 document.getElementById('wallet-balance').innerText = d.wallet_balance.toFixed(2);
            }
            
            document.getElementById('cur-price').innerText = d.current_price ? d.current_price.toFixed(2) : '---';
            document.getElementById('smi-val').innerText = d.smi ? d.smi.toFixed(4) : '--';
            
            const badge = document.getElementById('status-badge');
            const pauseBtn = document.getElementById('btn-pause');

            if(d.running) { 
                if (d.paused) {
                    badge.className='badge bg-warning text-dark'; 
                    badge.innerText='PAUSED';
                    pauseBtn.innerText = "‚ñ∂Ô∏è ÊÅ¢Â§ç";
                    pauseBtn.className = "btn btn-success w-100";
                    pauseBtn.disabled = false;
                } else {
                    badge.className='badge bg-success'; 
                    badge.innerText='RUNNING';
                    pauseBtn.innerText = "‚è∏ ÊöÇÂÅú";
                    pauseBtn.className = "btn btn-warning w-100";
                    pauseBtn.disabled = false;
                }
            } else { 
                badge.className='badge bg-secondary'; 
                badge.innerText='OFFLINE'; 
                pauseBtn.disabled = true;
                pauseBtn.innerText = "‚è∏ ÊöÇÂÅú";
                pauseBtn.className = "btn btn-warning w-100";
            }

            if (d.orders && d.orders.length) {
                const html = d.orders.map(o => `
                    <div class="grid-row ${o.style}">
                        <span style="width:10%">#${o.idx}</span>
                        <span style="width:30%">${o.price}</span>
                        <span style="width:20%">${o.type}</span>
                        <span style="width:20%">${o.amt}</span>
                    </div>`).join('');
                document.getElementById('grid-wall').innerHTML = html;
            }

            if (d.logs && d.logs.length) {
                document.getElementById('logs').innerHTML = d.logs.map(l => `<div>${l}</div>`).join('');
            }
        });
    }, 1500);
</script>
</body>
</html>