<!DOCTYPE html>
<html>

<head>
    <title>SignalGuard AutoPilot æ§åˆ¶å°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: #0b0e11;
            color: #d4d4d4;
            padding: 20px;
            font-family: 'Segoe UI', monospace;
            font-size: 13px;
        }

        .card {
            background: #1e2329;
            border: 1px solid #2b3139;
            margin-bottom: 15px;
            border-radius: 8px;
        }

        .card-header {
            border-bottom: 1px solid #2b3139;
            color: #a78bfa;
            font-weight: bold;
            padding: 12px 15px;
        }

        .form-control,
        .form-select {
            background: #161a1e;
            border: 1px solid #3b3f46;
            color: #fff;
            font-size: 12px;
        }

        .form-control:focus,
        .form-select:focus {
            background: #161a1e;
            color: #fff;
            border-color: #6366f1;
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.25);
        }

        .form-label {
            color: #848e9c;
            font-size: 11px;
            margin-bottom: 4px;
        }

        /* ä¸»å¼€å…³æ ·å¼ */
        .master-switch {
            background: linear-gradient(135deg, #1e2329 0%, #161a1e 100%);
            border: 2px solid #3b3f46;
            border-radius: 12px;
            padding: 20px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .master-switch.enabled {
            border-color: #22c55e;
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.2);
        }

        .switch-label {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .form-switch .form-check-input {
            width: 60px;
            height: 30px;
            cursor: pointer;
        }

        .form-switch .form-check-input:checked {
            background-color: #22c55e;
            border-color: #22c55e;
        }

        /* çŠ¶æ€å¾½ç«  */
        .status-badge {
            font-size: 0.9rem;
            padding: 8px 16px;
            border-radius: 20px;
        }

        .status-running {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: #fff;
        }

        .status-stopped {
            background: #3b3f46;
            color: #848e9c;
        }

        /* SMI å®æ—¶æ˜¾ç¤º */
        .smi-display {
            background: #161a1e;
            border: 1px solid #3b3f46;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            margin-top: 15px;
        }

        .smi-value {
            font-size: 2rem;
            font-weight: bold;
            color: #6366f1;
        }

        .smi-label {
            color: #848e9c;
            font-size: 0.8rem;
        }

        /* è§¦å‘å™¨æ˜¾ç¤º */
        .trigger-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed #2b3139;
        }

        .trigger-row:last-child {
            border-bottom: none;
        }

        .trigger-label {
            color: #848e9c;
        }

        .trigger-val-long {
            color: #22c55e;
            font-weight: bold;
        }

        .trigger-val-short {
            color: #ef4444;
            font-weight: bold;
        }

        /* ä¿å­˜æŒ‰é’® */
        .btn-save {
            background: linear-gradient(135deg, #6366f1 0%, #4338ca 100%);
            border: none;
            color: #fff;
            font-weight: bold;
            padding: 12px 40px;
            border-radius: 8px;
            font-size: 1rem;
        }

        .btn-save:hover {
            background: linear-gradient(135deg, #4f46e5 0%, #3730a3 100%);
            color: #fff;
        }

        /* æ¨¡å¼çŠ¶æ€ */
        .mode-indicator {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin-top: 15px;
        }

        .mode-none {
            background: #1e2329;
            border: 1px solid #3b3f46;
        }

        .mode-long {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid #22c55e;
        }

        .mode-short {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid #ef4444;
        }

        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #2b3139;
        }
    </style>
</head>

<body>
    <div class="container" style="max-width: 1400px;">
        <!-- å¤´éƒ¨ -->
        <div class="header-bar">
            <div>
                <h4 class="m-0" style="color: #a78bfa;">ğŸ¤– SignalGuard è‡ªåŠ¨é©¾é©¶æ§åˆ¶å°</h4>
                <small class="text-muted">SMI ä¿¡å·é©±åŠ¨çš„æ™ºèƒ½ç½‘æ ¼ç­–ç•¥</small>
            </div>
            <div>
                <span id="status-badge" class="status-badge status-stopped">â¹ æœªå¯ç”¨</span>
            </div>
        </div>

        <!-- ä¸»å¼€å…³ -->
        <div class="master-switch" id="master-switch">
            <div>
                <div class="switch-label" style="color: #fff;">AutoPilot ä¸»å¼€å…³</div>
                <small class="text-muted">å¯ç”¨åå°†è‡ªåŠ¨ç›‘æ§ SMI ä¿¡å·å¹¶æ‰§è¡Œå¼€å¹³ä»“æ“ä½œ</small>
            </div>
            <div class="d-flex align-items-center">
                <span id="mode-display" class="me-4 text-muted">å½“å‰æ¨¡å¼: <span id="current-mode"
                        class="text-warning">---</span></span>
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="main-switch" onchange="toggleSwitch()">
                </div>
            </div>
        </div>

        <!-- ä½œæˆ˜æŒ‡ä»¤ (Execution Target) -->
        <div class="card mb-4" style="border-color: #f59e0b;">
            <div class="card-header" style="color: #f59e0b;">ğŸ¯ ä½œæˆ˜æŒ‡ä»¤ (Execution Target)</div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label">ç›®æ ‡äº¤æ˜“æ‰€</label>
                        <select class="form-select" id="execution-exchange">
                            <option value="binance">Binance</option>
                            <option value="okx">OKX</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">ç›®æ ‡äº¤æ˜“å¯¹</label>
                        <input class="form-control" id="execution-symbol" value="BTC/USDT" placeholder="e.g. ETH/USDT">
                    </div>
                    <div class="col-md-4 d-flex align-items-end">
                        <small class="text-muted">ğŸ“Œ æŒ‡æŒ¥å®˜ï¼Œè¯·æŒ‡å®šæ£€æµ‹åˆ°ä¿¡å·åè¦å»æ”»æ‰“çš„ç›®æ ‡ã€‚</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¸‰åˆ—é…ç½® -->
        <div class="row">
            <!-- åˆ—1: ä¿¡å·å“¨å…µ -->
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">ğŸ“¡ ä¿¡å·å“¨å…µ (Sentinel)</div>
                    <div class="card-body">
                        <!-- åŠ¨æ€ç›‘æ§æºæ˜¾ç¤º -->
                        <div class="alert alert-dark d-flex align-items-center mb-3" style="border: 1px solid #3b3f46;">
                            <div class="me-3" style="font-size: 1.5rem;">ğŸ‘€</div>
                            <div>
                                <div class="text-muted" style="font-size: 0.8rem;">å½“å‰ä¸»é¡µç›‘æ§ (Source)</div>
                                <div id="monitor-source" style="font-weight: bold; color: #a78bfa;">ç­‰å¾…è¿æ¥...</div>
                            </div>
                        </div>
                        <small class="text-muted d-block mb-3">ğŸ“Œ AutoPilot è‡ªåŠ¨è·Ÿéšä¸»é¡µä»ªè¡¨ç›˜çš„ç¬¬ä¸€ä¸ªäº¤æ˜“å¯¹</small>

                        <hr style="border-color: #3b3f46;">
                        <h6 class="text-muted mb-3">è§¦å‘é˜ˆå€¼</h6>

                        <div class="row g-2 mb-2">
                            <div class="col-6">
                                <label class="form-label">å¼€å¤š (Long Open)</label>
                                <input class="form-control" id="long_open" type="number" step="0.01" value="-0.46">
                            </div>
                            <div class="col-6">
                                <label class="form-label">å¹³å¤š (Long Close)</label>
                                <input class="form-control" id="long_close" type="number" step="0.01" value="0.40">
                            </div>
                        </div>
                        <div class="row g-2">
                            <div class="col-6">
                                <label class="form-label">å¼€ç©º (Short Open)</label>
                                <input class="form-control" id="short_open" type="number" step="0.01" value="0.46">
                            </div>
                            <div class="col-6">
                                <label class="form-label">å¹³ç©º (Short Close)</label>
                                <input class="form-control" id="short_close" type="number" step="0.01" value="-0.40">
                            </div>
                        </div>

                        <!-- SMI å®æ—¶æ˜¾ç¤º -->
                        <div class="smi-display">
                            <div class="smi-label">å½“å‰ SMI å€¼</div>
                            <div class="smi-value" id="smi-value">---</div>
                            <small class="text-muted" id="smi-time">ç­‰å¾…æ•°æ®...</small>
                        </div>

                        <!-- å½“å‰æ¨¡å¼ -->
                        <div class="mode-indicator mode-none" id="mode-indicator">
                            <div class="text-muted">å½“å‰çŠ¶æ€</div>
                            <div id="mode-text" style="font-size: 1.1rem; font-weight: bold;">å¾…æœºä¸­</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- åˆ—2: åšå¤šæ¨¡æ¿ -->
            <div class="col-md-4">
                <div class="card" style="border-color: #22c55e;">
                    <div class="card-header" style="color: #22c55e;">ğŸ“ˆ åšå¤šæ¨¡æ¿ (Long Template)</div>
                    <div class="card-body">
                        <div class="row g-2 mb-3">
                            <div class="col-6">
                                <label class="form-label">ä¸Šç¼“å†² (%)</label>
                                <input class="form-control" id="long_upper_buffer" type="number" step="0.01"
                                    value="0.07">
                            </div>
                            <div class="col-6">
                                <label class="form-label">ä¸‹ç¼“å†² (%)</label>
                                <input class="form-control" id="long_lower_buffer" type="number" step="0.01"
                                    value="0.03">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">æ æ†å€æ•°</label>
                            <input class="form-control" id="long_leverage" type="number" value="5">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">æ¯æ ¼æ•°é‡</label>
                            <input class="form-control" id="long_amount" type="number" step="0.0001" value="0.001">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ç½‘æ ¼æ•°é‡</label>
                            <input class="form-control" id="long_grid_num" type="number" value="40">
                        </div>

                        <div class="alert alert-success py-2 px-3 mb-0"
                            style="background: rgba(34, 197, 94, 0.1); border-color: #22c55e; color: #22c55e;">
                            <small>ğŸ“Œ å½“ SMI < <span id="preview-long-open">-0.46</span> æ—¶è§¦å‘å¼€ä»“</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- åˆ—3: åšç©ºæ¨¡æ¿ -->
            <div class="col-md-4">
                <div class="card" style="border-color: #ef4444;">
                    <div class="card-header" style="color: #ef4444;">ğŸ“‰ åšç©ºæ¨¡æ¿ (Short Template)</div>
                    <div class="card-body">
                        <div class="row g-2 mb-3">
                            <div class="col-6">
                                <label class="form-label">ä¸Šç¼“å†² (%)</label>
                                <input class="form-control" id="short_upper_buffer" type="number" step="0.01"
                                    value="0.03">
                            </div>
                            <div class="col-6">
                                <label class="form-label">ä¸‹ç¼“å†² (%)</label>
                                <input class="form-control" id="short_lower_buffer" type="number" step="0.01"
                                    value="0.07">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">æ æ†å€æ•°</label>
                            <input class="form-control" id="short_leverage" type="number" value="5">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">æ¯æ ¼æ•°é‡</label>
                            <input class="form-control" id="short_amount" type="number" step="0.0001" value="0.001">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">ç½‘æ ¼æ•°é‡</label>
                            <input class="form-control" id="short_grid_num" type="number" value="40">
                        </div>

                        <div class="alert alert-danger py-2 px-3 mb-0"
                            style="background: rgba(239, 68, 68, 0.1); border-color: #ef4444; color: #ef4444;">
                            <small>ğŸ“Œ å½“ SMI > <span id="preview-short-open">0.46</span> æ—¶è§¦å‘å¼€ä»“</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ“ä½œæ  -->
        <div class="text-center mt-4">
            <button class="btn btn-save" onclick="saveConfig()">ğŸ’¾ ä¿å­˜é…ç½®</button>
            <small class="d-block text-muted mt-2">ä¿å­˜åé…ç½®å°†ç«‹å³ç”Ÿæ•ˆ (æ— éœ€é‡å¯æœåŠ¡)</small>
        </div>
    </div>

    <script>
        let configLoaded = false;

        // ============ é¡µé¢åŠ è½½ ============
        window.onload = function () {
            // é¦–æ¬¡åŠ è½½é…ç½® (å¡«å……è¡¨å•)
            loadConfig();
            // å®šæ—¶åˆ·æ–°ä»ªè¡¨ç›˜çŠ¶æ€ (æ¯3ç§’ï¼Œä¸è§¦ç¢°è¾“å…¥æ¡†)
            setInterval(updateDashboard, 3000);
        };

        // ============ åŠ è½½é…ç½® (ä»…é¦–æ¬¡æˆ–ä¿å­˜åè°ƒç”¨) ============
        function loadConfig() {
            fetch('/api/autopilot/status')
                .then(r => r.json())
                .then(data => {
                    if (data.status !== 'ok') {
                        console.error('è·å–é…ç½®å¤±è´¥:', data.msg);
                        return;
                    }

                    const config = data.config;
                    if (config) {
                        fillForm(config);
                        configLoaded = true;
                    }

                    // åŒæ—¶æ›´æ–°ä¸€æ¬¡ä»ªè¡¨ç›˜
                    updateDashboardFromData(data);
                })
                .catch(err => console.error('é…ç½®åŠ è½½å¤±è´¥:', err));
        }

        // ============ æ›´æ–°ä»ªè¡¨ç›˜ (å®šæ—¶è°ƒç”¨ï¼Œä¸ä¿®æ”¹è¾“å…¥æ¡†) ============
        function updateDashboard() {
            fetch('/api/autopilot/status')
                .then(r => r.json())
                .then(data => {
                    if (data.status !== 'ok') {
                        console.error('è·å–çŠ¶æ€å¤±è´¥:', data.msg);
                        return;
                    }
                    updateDashboardFromData(data);
                })
                .catch(err => console.error('çŠ¶æ€è·å–å¤±è´¥:', err));
        }

        // ============ ä»æ•°æ®æ›´æ–°ä»ªè¡¨ç›˜å…ƒç´  (ä¸è§¦ç¢° input/select) ============
        function updateDashboardFromData(data) {
            const state = data.state || {};
            const runtime = data.runtime || {};

            // 1. æ›´æ–°ä¸»å¼€å…³çŠ¶æ€
            const mainSwitch = document.getElementById('main-switch');
            const masterDiv = document.getElementById('master-switch');
            const statusBadge = document.getElementById('status-badge');

            mainSwitch.checked = state.enabled;

            if (state.enabled) {
                masterDiv.classList.add('enabled');
                statusBadge.className = 'status-badge status-running';
                statusBadge.innerText = 'ğŸŸ¢ ç›‘æ§ä¸­';
            } else {
                masterDiv.classList.remove('enabled');
                statusBadge.className = 'status-badge status-stopped';
                statusBadge.innerText = 'â¹ æœªå¯ç”¨';
            }

            // 2. æ›´æ–°å½“å‰æ¨¡å¼æ˜¾ç¤º
            const modeIndicator = document.getElementById('mode-indicator');
            const modeText = document.getElementById('mode-text');
            const currentMode = document.getElementById('current-mode');

            modeIndicator.className = 'mode-indicator';

            switch (state.current_mode) {
                case 'long':
                    modeIndicator.classList.add('mode-long');
                    modeText.innerText = 'ğŸ“ˆ åšå¤šè¿è¡Œä¸­';
                    modeText.style.color = '#22c55e';
                    currentMode.innerText = 'LONG';
                    currentMode.style.color = '#22c55e';
                    break;
                case 'short':
                    modeIndicator.classList.add('mode-short');
                    modeText.innerText = 'ğŸ“‰ åšç©ºè¿è¡Œä¸­';
                    modeText.style.color = '#ef4444';
                    currentMode.innerText = 'SHORT';
                    currentMode.style.color = '#ef4444';
                    break;
                default:
                    modeIndicator.classList.add('mode-none');
                    modeText.innerText = 'å¾…æœºä¸­';
                    modeText.style.color = '#848e9c';
                    currentMode.innerText = 'NONE';
                    currentMode.style.color = '#f0b90b';
            }

            // 3. æ›´æ–°å®æ—¶ SMI å’Œä»·æ ¼ (ä» runtime æ•°æ®)
            const smiValue = document.getElementById('smi-value');
            const smiTime = document.getElementById('smi-time');

            if (runtime.smi !== null && runtime.smi !== undefined) {
                smiValue.innerText = runtime.smi.toFixed(4);

                // æ ¹æ®è§¦å‘é˜ˆå€¼å˜è‰²
                const longOpen = parseFloat(document.getElementById('long_open').value) || -0.46;
                const shortOpen = parseFloat(document.getElementById('short_open').value) || 0.46;

                if (runtime.smi < longOpen) {
                    smiValue.style.color = '#22c55e'; // å¼€å¤šåŒº
                } else if (runtime.smi > shortOpen) {
                    smiValue.style.color = '#ef4444'; // å¼€ç©ºåŒº
                } else {
                    smiValue.style.color = '#6366f1'; // ä¸­æ€§åŒº
                }
            } else {
                smiValue.innerText = '---';
                smiValue.style.color = '#6366f1';
            }

            if (runtime.updated_at && runtime.updated_at > 0) {
                const ago = Math.floor(Date.now() / 1000 - runtime.updated_at);
                smiTime.innerText = ago < 60 ? `${ago}ç§’å‰æ›´æ–°` : `${Math.floor(ago / 60)}åˆ†é’Ÿå‰æ›´æ–°`;
            } else {
                smiTime.innerText = 'ç­‰å¾…æ•°æ®...';
            }

            // 4. æ›´æ–°ç›‘æ§æºæ˜¾ç¤º
            const monitorDisplay = document.getElementById('monitor-source');
            if (monitorDisplay) {
                if (runtime.monitor_symbol) {
                    monitorDisplay.innerText = `${runtime.monitor_symbol} (${runtime.monitor_tf})`;
                } else {
                    monitorDisplay.innerText = "ç­‰å¾…ä¸»é¡µæ•°æ®...";
                }
            }


        }

        // ============ å¡«å……è¡¨å• (ä»…è°ƒç”¨ä¸€æ¬¡) ============
        function fillForm(config) {
            // Execution
            if (config.execution) {
                document.getElementById('execution-exchange').value = config.execution.exchange || 'binance';
                document.getElementById('execution-symbol').value = config.execution.symbol || 'BTC/USDT';
            }

            // Sentinel (åªå¡«å…… Triggerï¼Œå…¶ä»–çš„å·²ç§»é™¤)
            if (config.sentinel && config.sentinel.triggers) {
                document.getElementById('long_open').value = config.sentinel.triggers.long_open || -0.46;
                document.getElementById('long_close').value = config.sentinel.triggers.long_close || 0.40;
                document.getElementById('short_open').value = config.sentinel.triggers.short_open || 0.46;
                document.getElementById('short_close').value = config.sentinel.triggers.short_close || -0.40;

                // æ›´æ–°é¢„è§ˆ
                const prevLong = document.getElementById('preview-long-open');
                const prevShort = document.getElementById('preview-short-open');
                if (prevLong) prevLong.innerText = config.sentinel.triggers.long_open;
                if (prevShort) prevShort.innerText = config.sentinel.triggers.short_open;
            }

            // Long Template
            if (config.template_long) {
                document.getElementById('long_upper_buffer').value = config.template_long.upper_buffer_pct || 0.07;
                document.getElementById('long_lower_buffer').value = config.template_long.lower_buffer_pct || 0.03;
                document.getElementById('long_leverage').value = config.template_long.leverage || 5;
                document.getElementById('long_amount').value = config.template_long.amount || 0.001;
                document.getElementById('long_grid_num').value = config.template_long.grid_num || 40;
            }

            // Short Template
            if (config.template_short) {
                document.getElementById('short_upper_buffer').value = config.template_short.upper_buffer_pct || 0.03;
                document.getElementById('short_lower_buffer').value = config.template_short.lower_buffer_pct || 0.07;
                document.getElementById('short_leverage').value = config.template_short.leverage || 5;
                document.getElementById('short_amount').value = config.template_short.amount || 0.001;
                document.getElementById('short_grid_num').value = config.template_short.grid_num || 40;
            }
        }

        // ============ ä¿å­˜é…ç½® ============
        function saveConfig() {
            const config = {
                execution: {
                    exchange: document.getElementById('execution-exchange').value,
                    symbol: document.getElementById('execution-symbol').value
                },
                sentinel: {
                    symbol: "AUTO",
                    timeframe: "AUTO",
                    smi_period: 14,
                    triggers: {
                        long_open: parseFloat(document.getElementById('long_open').value),
                        long_close: parseFloat(document.getElementById('long_close').value),
                        short_open: parseFloat(document.getElementById('short_open').value),
                        short_close: parseFloat(document.getElementById('short_close').value)
                    }
                },
                template_long: {
                    upper_buffer_pct: parseFloat(document.getElementById('long_upper_buffer').value),
                    lower_buffer_pct: parseFloat(document.getElementById('long_lower_buffer').value),
                    leverage: parseInt(document.getElementById('long_leverage').value),
                    amount: parseFloat(document.getElementById('long_amount').value),
                    grid_num: parseInt(document.getElementById('long_grid_num').value)
                },
                template_short: {
                    upper_buffer_pct: parseFloat(document.getElementById('short_upper_buffer').value),
                    lower_buffer_pct: parseFloat(document.getElementById('short_lower_buffer').value),
                    leverage: parseInt(document.getElementById('short_leverage').value),
                    amount: parseFloat(document.getElementById('short_amount').value),
                    grid_num: parseInt(document.getElementById('short_grid_num').value)
                }
            };

            fetch('/api/autopilot/update_config', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(config)
            })
                .then(r => r.json())
                .then(res => {
                    if (res.status === 'ok') {
                        alert('âœ… é…ç½®å·²ä¿å­˜ï¼');
                        // é‡æ–°åŠ è½½é…ç½®ä»¥ç¡®ä¿åŒæ­¥
                        loadConfig();
                    } else {
                        alert('âŒ ä¿å­˜å¤±è´¥: ' + res.msg);
                    }
                })
                .catch(err => alert('è¯·æ±‚é”™è¯¯: ' + err));
        }

        // ============ åˆ‡æ¢å¼€å…³ ============
        function toggleSwitch() {
            const enabled = document.getElementById('main-switch').checked;

            fetch('/api/autopilot/toggle', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ enabled: enabled })
            })
                .then(r => r.json())
                .then(res => {
                    if (res.status === 'ok') {
                        console.log('å¼€å…³åˆ‡æ¢æˆåŠŸ:', res.state);
                    } else {
                        alert('åˆ‡æ¢å¤±è´¥: ' + res.msg);
                        // æ¢å¤å¼€å…³çŠ¶æ€
                        document.getElementById('main-switch').checked = !enabled;
                    }
                })
                .catch(err => {
                    alert('è¯·æ±‚é”™è¯¯: ' + err);
                    document.getElementById('main-switch').checked = !enabled;
                });
        }
    </script>
</body>

</html>